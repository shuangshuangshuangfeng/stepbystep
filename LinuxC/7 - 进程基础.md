



# 进程的基本知识

需要了解的内容:

- 1. 进程标识符 pid

类型pid_t， 有符号的**16位整型数**，也就是说可以同时进行三万多进程

命令：ps

- 2. 父子进程的产生 

    - fork()

    -  vfork()

- 3. 进程的消亡及释放资源

    - wait()

    - waitpid()

- 4. 进程分配

- 5. exec函数族的使用

    - execl()

    - execp()

    - execle()

    - execv()

    - execvp()

- 6.  用户权限和组权限（u+s, g+s）

    - u+s

    - g+s

- 7. 观摩课：解释器文件

`#！/bin/sh`

- 8. system()

理解为fork, exec, wait的封装

- 9. 进程会计

acct()

- 10. 进程时间

times()

- 11. 守护进程

    - 会话session 标识sid

    - 终端

    - setsid() 成为守护进程

    - getpgrp() 返回当前进程组的ID

    - 单实例守护进程：锁文件/var/run/name.pid

    - 守护进程开机启动脚本文件 /etc/rc*...

- 12. 系统日志

    - syslogd服务

    - openlog();  

    - closelog();

    - syslog();





## 8. 进程system

man system :就**相当于一个 fork, exec, wait 的简单封装**

![](https://tcs.teambition.net/storage/312552545702145be1008a59e325c51d0ecc?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjU1MjU0NTcwMjE0NWJlMTAwOGE1OWUzMjVjNTFkMGVjYyJ9.R9WxV28Wtp0oIfJ5zT99Cbpug_rqPgB1Evv4Jw2uyhI&download=image.png "")



```c
#include <stdio.h>
#include <stdlib.h>

int main(){
        system("date +%s >/tmp/out");

        exit(0);
}

```



## 9. 进程会计： acct(); 方言，将进程信息写在一个文件中





## 10. 进程时间 times();

`time ./primer1`  是执行primer1的时间，原理： 当前父进程在等子进程的时候在掐时间，所以说当前时间（等待子进程时间）包括等在子进程结束的时间，都会纳入到这个时间当中去。`times` 函数用来完成time命令的。



`man times `结果如下：

![](https://tcs.teambition.net/storage/3125d19986a6c3f777147eca5d2582c0209b?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjVkMTk5ODZhNmMzZjc3NzE0N2VjYTVkMjU4MmMwMjA5YiJ9.sjgWK8mMb2ZVhmJnivfWcWuF6xUVCTNbsaw4xi9AN8M&download=image.png "")

计时单位：clock_t  滴答数， 一秒钟的滴答数可以用一个宏来检测，如下

![](https://tcs.teambition.net/storage/3125180e745328ab89069b797c83b8f36888?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjUxODBlNzQ1MzI4YWI4OTA2OWI3OTdjODNiOGYzNjg4OCJ9.rpYR3yKJBkxWniXE0HCn-PVHbJ82fzG2Eo_2cNJCVh0&download=image.png "")

tms的四个时间碎片拼一起就是一个time命令。





## 11. 守护进程

守护进程可以理解成服务，一些系统级模块，开机启动的时候，需要进程一直在后台跑的，这种程序被称为守护进程，比如:Httpd守护进程， dhcp（动态分配IP地址）， ssh服务，等等，

当我们执行`ps`命令的时候，看到的一些后台跑的内容，有很多本身就是守护进程。无论是windows还是linux, 都是有守护进程。

守护进程一般满足如下条件：

- 脱离控制终端（因为控制终端的输入和输出会对它有影响）

- 会话的leader

- group的leader



### 会话session sid  （终端）

我们平时接触的都是**虚拟终端**，实际意义上的终端是一个笨设备。。只会两个操作，输入和输出。。一般在银行这种要求安全性比较高的地方，可能会有真正意义上的终端存在。



在学并发这个模块的时候，就会发现，进程实际上就是容器，在我们的处理器处理当前的调度的时候，其实它是以线程为单位来调度的，所以认为多线程的并发要比多进程的并发要更规范，

![](https://tcs.teambition.net/storage/3125a10ce7e76e98cfb2e56ed3fc2bb888db?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjVhMTBjZTdlNzZlOThjZmIyZTU2ZWQzZmMyYmI4ODhkYiJ9.HqzVPujfHTlSCLUvE362hlUoireDW0SBgkqyuteQPIc&download=image.png "")



**进程组分为：前台进程组和后台进程组，最多可以有一个前台进程组，可以没有前台进程组**。

如果一个程序运行的会久一些，我不希望它占着我的命令行，终端，我还会做别的事情，那我在这条命令后面加一个地址符号，也就意味着，当前这条命令我要放到后台去运行。

前台进程组能够接受标准输入，能够标准输出，后台进程组不行。如果不区分前台进程组和后台进程组，我们不知道命令行输出的是哪个进程组的。

**所以我们的守护进程的标准的输入和输出我们会进行重定向。**



### session也有它的一个标识：sid,

![](https://tcs.teambition.net/storage/31252cd0c63a7826ea946995a8a5db014c96?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjUyY2QwYzYzYTc4MjZlYTk0Njk5NWE4YTVkYjAxNGM5NiJ9.z5JFWwK9m1EFgvGAXoefljjLWuFkyCkOb-RAGzQzTP0&download=image.png "")

如果当前调用这个函数的进程不是一个group leader的话，会创建一个新的session。调用这个函数的进程会成为新的session的leader。其实**调用setsid()进程的特点就是守护进程的特点**。



### setsid() 设置为守护进程

`**ps-axj **`

- TTY表示的是控制终端，守护进程是脱离控制终端的， 所以打问号?的是守护进程。

- 利用setsid()之后，当前的进程会成为session的leader, 会成为group的leader， **所以说它的PID, PGID,SID是相同的。**

- 由于守护进程在执行的时候，父进程会一直在等着，比如：FTP是从开机就开始，父进程一直在等着，既然子进程调用setsid()以后会变成守护进程，直接让父进程退出，父进程不需要收尸，如果父进程退出了，那么当前守护进程的父进程的PPID值就为1， init进程

![](https://tcs.teambition.net/storage/3125ffb5bc42184811cb03f89d0df4b68e7e?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjVmZmI1YmM0MjE4NDgxMWNiMDNmODlkMGRmNGI2OGU3ZSJ9.DCFGto7Sp5vXWZOlEUF6saaqh1MLCNFNvsoyYEGVNms&download=image.png "")



### 守护进程实例：

- getpgrp() 获得当前进程的进程组ID

- 

![](https://tcs.teambition.net/storage/3125bdc4c92ebb1062baf939bdd45b5b720d?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjViZGM0YzkyZWJiMTA2MmJhZjkzOWJkZDQ1YjViNzIwZCJ9.hKJFjt_7xWyxXlByhnESCDCa5zK8SYPfCsb2hr74_pA&download=image.png "")



vim定位到第59行代码的时候，在控制模式下输入`:59`

**注意： 守护进程要根据进程号去kil掉， kill 是通过发信号终止的进程**



### 单实例守护进程

锁文件：/var/sun/name.pid

![](https://tcs.teambition.net/storage/3125a5a1eb1a68cc16d48ee15086ce39a19e?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjVhNWExZWIxYTY4Y2MxNmQ0OGVlMTUwODZjZTM5YTE5ZSJ9.dZzCdf-So3sSq0bApCSnmtCXNa595vZWHYH5Kx3xYGo&download=image.png "")

比如ssh

![](https://tcs.teambition.net/storage/3125eea50fe2bcce31eedecc72b7bad8cfa2?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjVlZWE1MGZlMmJjY2UzMWVlZGVjYzcyYjdiYWQ4Y2ZhMiJ9.ff5BXk3NgWU5QFILadsPkCr-rbc6SsTDayutNDSvPjk&download=image.png "")

每次开机启动，守护进程都会在这个目录下产生一个锁文件，用来记录进程的pid，把当前这次的进程编号写进去。



### 守护进程的开机启动脚本文件 /etc/rc*... 不同操作系统不一样的名字

![](https://tcs.teambition.net/storage/312517426526f7cce529c5497ac92567af59?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjUxNzQyNjUyNmY3Y2NlNTI5YzU0OTdhYzkyNTY3YWY1OSJ9.fbJTHIwR2z40g8cTcLEUu25suF1_qaqfFzgdTjGliGo&download=image.png "")

这个文件目录下的文件如下：文件都是开机启动脚本

![](https://tcs.teambition.net/storage/3125314a68b70734ff75c6112f59b4c8243f?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjUzMTRhNjhiNzA3MzRmZjc1YzYxMTJmNTliNGM4MjQzZiJ9.-ZHEHpRsYNDb6oYfEt3L_H-qhT7MXQiY_SUzUaia64Y&download=image.png "")

![](https://tcs.teambition.net/storage/31251dd5a70f83dc1ce97dc5e0c15de3f8e8?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjUxZGQ1YTcwZjgzZGMxY2U5N2RjNWUwYzE1ZGUzZjhlOCJ9.MihrQwp8D4lhwcb7WdO-vfYvML3ZLZyS0NkoRGI_wUc&download=image.png "")



### 系统运行级别

刚刚看守护进程的截图：

![](https://tcs.teambition.net/storage/3127952af2eb5421e2c0d7bbc91f5b82b7f5?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjc5NTJhZjJlYjU0MjFlMmMwZDdiYmM5MWY1YjgyYjdmNSJ9.sX_pGFG_3Pfzal_T0x0XV06MCaVOTe6IziZHeYCoC6w&download=image.png "")

**那么rc0, rc1, ... , 他们的区别是????**



linux的运行级别：

- 0： 系统停机状态， 系统默认运行级别不能设为0， 否则不能正常启动

- 1： 单用户工作状态，root权限，用于系统维护，禁止远程登陆

- 2： 多用户状态（没有NFS）

- 3： 完全的都用户状态（有NFS）， 登录后进入控制台命令行模式

- 4： 系统未使用，保留

- 5： X11控制台，登陆后进入图形GUI模式

- 6： 系统正常关闭并启动，默认允许级别不能设为6，否则不能正常启动

**分别对应守护进程中的rcN.d目录， 系统会根据指定的运行级别进入对应的rcN.d目录，并按照文件名顺序检索目录下的链接文件。**

链接文件分为两种：

- 以K开头的文件，系统将终止对应的服务

- 以S开头的文件，系统将启动对应的服务

![](https://tcs.teambition.net/storage/3127c42aaf03a9e87573fc1f20feb01535f3?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjdjNDJhYWYwM2E5ZTg3NTczZmMxZjIwZmViMDE1MzVmMyJ9.uvRWyZx1b9EB69aU7rou9HjvgGsbAQx5yci0XWHqo08&download=image.png "")

`runlevel` 查看系统运行级别， 缺省状态下，运行级别一般为3





## 12. 系统日志

**注意**： 每一个应用程序都有必要去写系统日志， 系统日志的位置: `/var/log/`

![](https://tcs.teambition.net/storage/312595a6428222ce8ace77e7f110e0d9f747?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjU5NWE2NDI4MjIyY2U4YWNlNzdlN2YxMTBlMGQ5Zjc0NyJ9.2tVBCqdMGS_l1XkCyovooIlXICRWqs2rWCIlOVD6czw&download=image.png "")

主日志文件是message文件，但是不能让人人都可以，比如格式，文件啥的，**做了一个权限分割层，是syslogd服务，所有的要写系统日志的内容，都把自己要写的这个日志提交给syslogd这项服务，然后由这个服务进行统一的系统日志的写法，所以只需要按照一定的函数接口，将要写的内容提交给syslogd就可以了**



### syslogd服务

我们可以通过 `ps axj | grep "syslogd"`， 搜索服务

![](https://tcs.teambition.net/storage/3125d1ad018d47536cd8b88be079c4a8cafb?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTYzMTUzNTUxNiwiaWF0IjoxNjMwOTMwNzE2LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMjVkMWFkMDE4ZDQ3NTM2Y2Q4Yjg4YmUwNzljNGE4Y2FmYiJ9.GIw4pUMPm3kJ0wPLd_5LKnRG5OwKBPI1XwGxclFq54c&download=image.png "")



如果需要改写入系统日志的约定，需要改`/etc/sysconfig/rsyslog` 这个服务的约定



